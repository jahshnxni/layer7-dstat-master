<script>
  window.onload = () => {
    let info = document.getElementById("info");

    let chart = Highcharts.chart("chart", {
      exporting: { enabled: true },
      chart: { type: "area" },
      title: { text: "Layer7 DSTAT" },
      xAxis: { type: "datetime" },
      yAxis: { title: { text: "" } },
      series: [{ name: "Requests", data: [] }],
    });

    info.innerText = "Capturing requests from " + location.host + "/dstat";

    // Update the WebSocket URL to use the full URL for Vercel
    let ws = new WebSocket(`wss://${location.host}/api/ws`);  // WebSocket endpoint via serverless function

    ws.onmessage = (event) => {
      let requests = Number(event.data);
      let time = new Date().getTime();
      chart.series[0].addPoint([time, requests], true, chart.series[0].points.length > 60);
    };
  };
</script>
